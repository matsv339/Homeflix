angular.module('playerModule').controller('PlayerController', function($scope, $rootScope, $routeParams, $location) {
    //Find the movie on server
    $scope.moviePath = "assets/" + $routeParams.imdb_id + ".mp4";
    //Initialises the player
    $scope.init = function() {
        $scope.moviePath = '<%= asset_path("test_mid.mp4")%>'
        videojs("player", {preload: "auto", autoplay: false}, function() {
            $scope.player = this;
            $scope.player.height("100%");
            $scope.player.width("100%");
            $scope.player.controls(true);
            $scope.player.src($scope.moviePath); 
            $scope.player.play();
        });
    };

    $scope.init();   

    //Removes the player when route from player. 
    $rootScope.$on("$locationChangeStart", function(event, next, current){
        url = "http://" + $location.host() + ":" + $location.port() + "/#/player/" + $routeParams.imdb_id;
        if (url == current && $scope.player) {
            try {
                $scope.player.dispose();    
            }
            //Hides a wierd error in the player cleanup.
            catch(error) {
                // console.log(error);
            }
            
        }
    });
});

