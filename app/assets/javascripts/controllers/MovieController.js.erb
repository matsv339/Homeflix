var movieControllers = angular.module('movieControllers', ['favoritControllers']);


movieControllers.controller('MovieController', function($scope, $http, Movies, IMDB) {
    Movies.index(function(data) {
        $scope.movies = [];
        for(var id = 0;id < data.length; id++) {
            addIMDBData($http, id, data[id].imdbID, $scope.movies);
        }
    });
});

function addIMDBData($http, id, imdbID, movies) {
    $http.get('http://www.omdbapi.com/?i=' + imdbID).success(function(data) {
        data.id = id;
        console.log(data);
        movies.push(data);
        // return data;
    });
}

movieControllers.controller('MovieDetailedController', function($scope, $routeParams, $http) {
    $scope.imdbID = $routeParams.imdbID;
    $scope.movieID = $routeParams.movieID;
    $http.get('http://www.omdbapi.com/?i=' + $scope.movieID).success(function(data) {
        $scope.movie = data;
        // $scope.temp = 
        $scope.rating = new Array(Math.round($scope.movie.imdbRating/2));
    });

});


movieControllers.controller('PlayerController', function($scope, $http, $routeParams, $location) {
    $scope.moviePath = "assets/" + $routeParams.movieID + ".mp4";
    $scope.moviePath = "assets/tt1229340.mp4";
    
    // //Checks if the video exsists
    // $http.get($scope.moviePath).success(function(data) {

            
    // }).error(function() {
    //     player.poster('assets/error_poster.jpg');
    //     console.log("neh");
    // });

    //Initialises the player
    videojs("player", {}, function() {
        
    });
    
    //Apply the src to the video
    videojs("player").ready(function() {     
        player = this;
        player.pause();
        player.src($scope.moviePath);    
        player.play();
    });
        
        
    
    //Routes back to the spesific movie page when the movie finish.
    player.on("ended", function() {
        $location.path('/movies/' + $routeParams.movieID);
        $scope.$apply();
    });
});

