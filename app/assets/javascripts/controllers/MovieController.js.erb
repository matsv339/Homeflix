var movieControllers = angular.module('movieControllers', ['favoritControllers']);


movieControllers.controller('MovieListController', function($scope, $http, Movies, IMDB) {
    Movies.index(function(data) {
        $scope.movies = [];
        for(var i = 0;i < data.length; i++) {
            $http.get('http://www.omdbapi.com/?i=' + data[i].imdb_id).success(function(data) {
                $scope.movies.push(data);
            });
        }
    });
});

movieControllers.controller('MovieDetailedController', function($scope, $routeParams, $http) {
    $scope.imdb_id = $routeParams.imdb_id;
    
    $http.get('http://www.omdbapi.com/?i=' + $scope.imdb_id).success(function(data) {
        $scope.movie = data;
        $scope.rating = new Array(Math.round($scope.movie.imdbRating/2));
    });

});

movieControllers.controller('PlayerController', function($scope, $routeParams, $location) {
    //Find the movie on server
    // $scope.moviePath = "assets/" + $routeParams.imdb_id + ".mp4";
    //Override to only play sample video
    $scope.moviePath = '<%= asset_path("tt1229340.mp4")%>';
    //Initialises the player
    videojs("player", {controls: true, preload: "auto", autoplay: true, width: "100%", height: "100%"}, function() {
        player = this;
        player.pause();
        player.src($scope.moviePath);    
        player.play();
    });
        
    //Routes back to the spesific movie page when the movie finish.
    player.on("ended", function() {
        $location.path('/movies/' + $routeParams.imdb_id);
        $scope.$apply();
    });
});

